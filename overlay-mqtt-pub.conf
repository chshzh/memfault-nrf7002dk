# MQTT Client with TLS overlay configuration
# Use this overlay to enable MQTT client with TLS encryption
#
# Build with:
#   west build -b nrf7002dk/nrf5340/cpuapp -- -DEXTRA_CONF_FILE=overlay-mqtt-pub.conf
#   west build -b nrf7002dk/nrf5340/cpuapp -p -- -DSB_CONFIG_NETCORE_HCI_IPC=y -DEXTRA_CONF_FILE=overlay-mqtt-pub.conf

# Enable MQTT client feature
CONFIG_MQTT_CLIENT_ENABLED=y
CONFIG_MQTT_CLIENT_BROKER_HOSTNAME="test.mosquitto.org"
CONFIG_MQTT_CLIENT_PUBLISH_TOPIC="Count"
CONFIG_MQTT_CLIENT_PUBLISH_INTERVAL_SEC=60

# MQTT client logging
CONFIG_MQTT_CLIENT_LOG_LEVEL_INF=y

# MQTT Helper library
CONFIG_MQTT_HELPER=y
CONFIG_MQTT_CLEAN_SESSION=y

# TLS for MQTT
CONFIG_MQTT_LIB_TLS=y
CONFIG_MQTT_HELPER_PORT=8883
CONFIG_MQTT_KEEPALIVE=30

# Certificate provisioning - mqtt_helper will auto-provision from cert folder
CONFIG_MQTT_HELPER_SEC_TAG=955
CONFIG_MQTT_HELPER_PROVISION_CERTIFICATES=y
CONFIG_MQTT_HELPER_CERTIFICATES_FOLDER="cert"

# TLS credentials backend
CONFIG_TLS_CREDENTIALS_BACKEND_PROTECTED_STORAGE=y

# Increase TLS credential slots for MQTT + HTTPS + Memfault
# Default is 4, need more for multiple TLS connections
CONFIG_TLS_MAX_CREDENTIALS_NUMBER=8

# Need to support additional TLS context for MQTT
CONFIG_NET_SOCKETS_TLS_MAX_CONTEXTS=3
CONFIG_NET_SOCKETS_TLS_MAX_CLIENT_SESSION_COUNT=3
