# HTTPS Client overlay configuration
# Use this overlay to enable periodic HTTPS client requests
#
# Build with:
#   west build -b nrf7002dk/nrf5340/cpuapp -- -DEXTRA_CONF_FILE=overlay-https-req.conf
#   west build -b nrf7002dk/nrf5340/cpuapp -p -- -DSB_CONFIG_NETCORE_HCI_IPC=y -DEXTRA_CONF_FILE=overlay-https-req.conf

# Enable HTTPS client functionality
CONFIG_HTTPS_CLIENT_ENABLED=y

# Increase mbedTLS heap for concurrent TLS connections
# Each TLS handshake needs ~30-40KB, so we need ~100KB for 2+ concurrent connections
CONFIG_MBEDTLS_HEAP_SIZE=120000
# Need to support up to 3 concurrent TLS connections for FOTA, Memfault, and HTTPS client
CONFIG_NET_SOCKETS_TLS_MAX_CONTEXTS=3
CONFIG_NET_SOCKETS_TLS_MAX_CLIENT_SESSION_COUNT=3

# Configure HTTPS hostname and interval
CONFIG_HTTPS_HOSTNAME="example.com"
CONFIG_HTTPS_REQUEST_INTERVAL_SEC=60

# HTTPS client logging
CONFIG_HTTPS_CLIENT_LOG_LEVEL_INF=y

# Network socket requirements
CONFIG_NET_SOCKETS=y
CONFIG_POSIX_API=y

# TLS/HTTPS support - use Nordic Security Backend
CONFIG_NET_SOCKETS_SOCKOPT_TLS=y
CONFIG_TLS_CREDENTIALS=y

# Nordic Security Backend (nrf_security) for TLS
CONFIG_NORDIC_SECURITY_BACKEND=y
CONFIG_NRF_SECURITY=y
CONFIG_PSA_WANT_ALG_SHA_256=y
CONFIG_PSA_WANT_KEY_TYPE_RSA_PUBLIC_KEY=y

# Networking stack size adjustments for TLS
# CONFIG_NET_TX_STACK_SIZE=4096
# CONFIG_NET_RX_STACK_SIZE=4096

# Memory adjustments for HTTPS
# CONFIG_HEAP_MEM_POOL_SIZE=61440
# CONFIG_MAIN_STACK_SIZE=4096
# CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=2048

# DNS resolver
CONFIG_DNS_RESOLVER=y
CONFIG_DNS_RESOLVER_ADDITIONAL_BUF_CTR=2
CONFIG_DNS_RESOLVER_ADDITIONAL_QUERIES=2
